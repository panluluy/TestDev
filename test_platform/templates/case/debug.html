{% extends 'manager.html' %}
{% block manager %}
<style>
    body {
    margin: 0;
    font-family: Nunito,-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica Neue,Arial,sans-serif;
    font-size: .875rem;
    font-weight: 400;
    line-height: 2.5;
    color: #495057;
    text-align: left;
    background-color: #f5f9fc;
}
</style>
<div class="col-12 col-lg-12 d-flex">
    <div class="card flex-fill">
        <div class="card-header">
            <h5 class="card-title mb-0" style="float:left">添加用例</h5>
        </div>
        <div id="datatables-dashboard-products_wrapper"
             class="dataTables_wrapper dt-bootstrap4 no-footer">
            <div class="row">
                <div class="col-sm-12">
                    <div style="margin-left: 20px;margin-right: 20px; width: 80%">

                        <!-- URL -->
                        <div class="input-group option">
                            <span class="input-group-addon option-tile">请求地址：</span>
                            <input id="req_url" type="text" class="form-control" >
                        </div>

                        <!-- 请求方法 -->
                        <div class="option">
                            <label>请求方法：</label>
                            <label class="radio-inline">
                                <input type="radio" name="req_method" id="get" value="get" checked> GET
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="req_method" id="post" value="post"> POST
                            </label>
                        </div>

                        <!-- 请求头 -->
                        <div class="input-group option">
                            <span class="input-group-addon option-tile">请求头部：</span>
                            <input id="header" type="text" class="form-control" >
                        </div>

                        <div style="margin-top: 10px;">
                            <label>参数类型：</label>
                            <label class="radio-inline">
                                <input type="radio" name="par_type" id="form" value="form" checked> form-data
                            </label>
                            <label class="radio-inline">
                                <input type="radio" name="par_type" id="json" value="json"> JSON
                            </label>
                        </div>

                        <div class="input-group option">
                            <span class="input-group-addon option-tile">请求参数：</span>
                            <input id="parameter" type="text" class="form-control" >
                        </div>

                        <p>说明：以字典的方式设置参数，如：{"id":1, "name":"名称"}</p>

                        <div style="float: right;margin-right: 10px;">
                            <button type="button" class="btn btn-primary" onclick="sendFun()">发送</button>
                        </div>

                        <div style="margin-top: 30px;">
                            <p>返回结果：</p>
                            <textarea id="result" class="form-control" rows="10" name=textarea></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

    //初始化JSONeditor编辑框
    // var headers = document.getElementById("headerEditor");
    // var parameters = document.getElementById("parameterEditor");
    // var options = {
    //     mode: "code"
    // };
    // var headerEditor = new JSONEditor(headers, options);
    // var parameterEditor = new JSONEditor(parameters, options);

    function sendFun() {
        // 获取用例管理界面中每个部分的值
        req_url = $('#req_url').val();
        req_method = $('input[name="req_method"]:checked').val();
        req_header = $('#header').val();

        // 使用在线的json的cdn获取请求头中的值需要更换新的方法
        // req_header = headerEditor.get(); 

        req_type = $('input[name="par_type"]:checked').val();

        req_parameter = $('#parameter').val();

        // 使用在线的json的cdn获取请求参数中的值需要更换新的方法
        // req_parameter = parameterEditor.get(); 

        // 用于将 JavaScript 值转换为 JSON 字符串
        // let req_header_str = JSON.stringify(req_header, null, 2);
        // let req_parameter_str = JSON.stringify(req_parameter, null, 2);
        // console.log("req_par", req_parameter_str);  

        // 前端增加对url为空进行判断
        if ( req_url === ""){
            window.alert("URL地址不能为空");
            return;
        }
        // 此种方法用户点击发送按钮后，继续保留页面中的数据
        $.get("/case/send_req/",{
            url:req_url,
            method:req_method,
            header:req_header,
            par_type:req_type,
            par_value:req_parameter
        },
        // 将接口返回的数据写入到返回结果文本框
        function(resp){
            console.log("resp",resp);
            if(resp.status === 200){
                document.querySelector("#result").value = resp.data;
            }else{
                window.alert(resp.message);
            }
        });
    }
</script>


{% endblock %}